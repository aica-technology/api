"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[737],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>k});var n=t(7294);function i(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){i(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function r(e,a){if(null==e)return{};var t,n,i=function(e,a){if(null==e)return{};var t,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(i[t]=e[t]);return i}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=n.createContext({}),p=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},d=function(e){var a=p(e.components);return n.createElement(s.Provider,{value:a},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),c=p(t),u=i,k=c["".concat(s,".").concat(u)]||c[u]||m[u]||o;return t?n.createElement(k,l(l({ref:a},d),{},{components:t})):n.createElement(k,l({ref:a},d))}));function k(e,a){var t=arguments,i=a&&a.mdxType;if("string"==typeof e||i){var o=t.length,l=new Array(o);l[0]=u;var r={};for(var s in a)hasOwnProperty.call(a,s)&&(r[s]=a[s]);r.originalType=e,r[c]="string"==typeof e?e:i,l[1]=r;for(var p=2;p<o;p++)l[p]=t[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},5489:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var n=t(7462),i=(t(7294),t(3905));const o={sidebar_position:5,title:"Package builder configuration reference"},l="aica-package.toml configuration reference",r={unversionedId:"reference/custom-components/aica-package-toml",id:"reference/custom-components/aica-package-toml",title:"Package builder configuration reference",description:"The aica-package.toml file is used to configure the build process for a component package.",source:"@site/docs/reference/custom-components/05-aica-package-toml.md",sourceDirName:"reference/custom-components",slug:"/reference/custom-components/aica-package-toml",permalink:"/docs/reference/custom-components/aica-package-toml",draft:!1,editUrl:"https://github.com/aica-technology/api/tree/main/docs/docs/reference/custom-components/05-aica-package-toml.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"Package builder configuration reference"},sidebar:"programmingReferenceSidebar",previous:{title:"Building a component package",permalink:"/docs/reference/custom-components/package-building"},next:{title:"Migrating from older versions of `package-builder`",permalink:"/docs/reference/custom-components/aica-package-migrations"}},s={},p=[{value:"<code>TOML</code> syntax",id:"toml-syntax",level:2},{value:"<code>aica-package.toml</code> file structure",id:"aica-packagetoml-file-structure",level:2},{value:"<code>#syntax</code>",id:"syntax",level:3},{value:"<code>[build]</code>",id:"build",level:3},{value:"<code>[build.type]</code>",id:"buildtype",level:4},{value:"<code>[build.ssh]</code>",id:"buildssh",level:4},{value:"<code>[build.image]</code>",id:"buildimage",level:4},{value:"<code>[build.cmake-args]</code>",id:"buildcmake-args",level:4},{value:"<code>[build.apt-repos]</code>",id:"buildapt-repos",level:4},{value:"Using a <code>deb</code> file",id:"using-a-deb-file",level:5},{value:"Using a repository (with an optional keyring)",id:"using-a-repository-with-an-optional-keyring",level:5},{value:"<code>[build.dependencies]</code>",id:"builddependencies",level:4},{value:"Adding version constraints",id:"adding-version-constraints",level:5},{value:"Adding build-time dependencies",id:"adding-build-time-dependencies",level:5},{value:"<code>[build.run-dependencies]</code>",id:"buildrun-dependencies",level:4},{value:"<code>[build.packages]</code>",id:"buildpackages",level:4},{value:"<code>[build.packages.XYZ.dependencies.apt]</code>",id:"buildpackagesxyzdependenciesapt",level:5},{value:"<code>[build.packages.XYZ.dependencies.pip]</code>",id:"buildpackagesxyzdependenciespip",level:5},{value:"<code>[build.stages]</code>",id:"buildstages",level:4},{value:"<code>[metadata]</code>",id:"metadata",level:3},{value:"<code>[metadata.version]</code>",id:"metadataversion",level:4},{value:"<code>[metadata.description]</code>",id:"metadatadescription",level:4},{value:"<code>[metadata.collection]</code>",id:"metadatacollection",level:4},{value:"Advanced usage",id:"advanced-usage",level:4},{value:"<code>docker-image://</code>",id:"docker-image",level:5},{value:"<code>build-context://</code>",id:"build-context",level:5},{value:"Version constraints",id:"version-constraints",level:5},{value:"Examples",id:"examples",level:3},{value:"Basic setup",id:"basic-setup",level:4},{value:"With dependencies",id:"with-dependencies",level:4},{value:"Advanced usage",id:"advanced-usage-1",level:4},{value:"Custom stage",id:"custom-stage",level:4},{value:"<code>docker build</code> usage",id:"docker-build-usage",level:2}],d={toc:p},c="wrapper";function m(e){let{components:a,...t}=e;return(0,i.kt)(c,(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"aica-packagetoml-configuration-reference"},(0,i.kt)("inlineCode",{parentName:"h1"},"aica-package.toml")," configuration reference"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," file is used to configure the build process for a component package."),(0,i.kt)("h2",{id:"toml-syntax"},(0,i.kt)("inlineCode",{parentName:"h2"},"TOML")," syntax"),(0,i.kt)("p",null,"The configuration uses the simple ",(0,i.kt)("a",{parentName:"p",href:"https://toml.io/en/"},"TOML")," file format which is easy to read and write. Here are a\nfew examples:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml"},'# add a category\n[category]\n# then you can add keys and values\nkey-string = "value string"\nkey-bool = true\nkey-int = 42\nkey-float = 3.14\n\n# you can nest categories\n[category.sub-category]\nkey = "value"\n')),(0,i.kt)("p",null,"Note that each ",(0,i.kt)("inlineCode",{parentName:"p"},"string")," value needs to be quoted, but keys and values of other types do not."),(0,i.kt)("h2",{id:"aica-packagetoml-file-structure"},(0,i.kt)("inlineCode",{parentName:"h2"},"aica-package.toml")," file structure"),(0,i.kt)("p",null,"This example contains every possible key and value that can be used in an ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," file and explains each of\nthem."),(0,i.kt)("h3",{id:"syntax"},(0,i.kt)("inlineCode",{parentName:"h3"},"#syntax")),(0,i.kt)("p",null,"Each ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," should start with ",(0,i.kt)("inlineCode",{parentName:"p"},"#syntax=ghcr.io/aica-technology/package-builder"),". This is used to specify\nthe Docker syntax and version used to build the package."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},"#syntax=ghcr.io/aica-technology/package-builder:v1\n")),(0,i.kt)("p",null,"You can find the available\nversions ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/orgs/aica-technology/packages/container/package/package-builder"},"here"),"."),(0,i.kt)("p",null,"The upcoming sections describe the syntax for the ",(0,i.kt)("inlineCode",{parentName:"p"},"package-builder")," version ",(0,i.kt)("inlineCode",{parentName:"p"},"1.0.0")," and later. If you are migrating from an older version, please refer to the corresponding guide:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/reference/custom-components/aica-package-migrations#migrating-from-0-0-x"},"Migrating from ",(0,i.kt)("inlineCode",{parentName:"a"},"0.0.X")))),(0,i.kt)("h3",{id:"build"},(0,i.kt)("inlineCode",{parentName:"h3"},"[build]")),(0,i.kt)("h4",{id:"buildtype"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.type]")),(0,i.kt)("p",null,"Required. The only ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.type]")," currently supported is ",(0,i.kt)("inlineCode",{parentName:"p"},"ros"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build]\ntype = "ros"\n')),(0,i.kt)("h4",{id:"buildssh"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.ssh]")),(0,i.kt)("p",null,"Optional. Default is ",(0,i.kt)("inlineCode",{parentName:"p"},"false"),". If set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),", any call to ",(0,i.kt)("inlineCode",{parentName:"p"},"CMake"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"pip")," or custom stage will have access to the SSH credentials given to Docker with ",(0,i.kt)("inlineCode",{parentName:"p"},"--ssh default"),". This is useful if you need to clone a private repository in CMakeLists.txt or install a private Python package from git."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},"[build]\nssh = false\n")),(0,i.kt)("h4",{id:"buildimage"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.image]")),(0,i.kt)("p",null,"Required. ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.image]")," is the tag of the AICA ",(0,i.kt)("inlineCode",{parentName:"p"},"ghcr.io/aica-technology/ros2-ws")," image that will be used to build the components. Those images are tagged after the versions of the ROS 2 distributions and are available ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/aica-technology/docker-images/pkgs/container/ros2-ws"},"here"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build]\nimage = "v1.0.0-iron"\n')),(0,i.kt)("h4",{id:"buildcmake-args"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.cmake-args]")),(0,i.kt)("p",null,"Optional. In this category, you can specify arguments which will be passed to CMake through ",(0,i.kt)("inlineCode",{parentName:"p"},"-DK1=V1 -DK2=V2 ...")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.cmake-args]\n# here are a few examples\nPACKAGE_NAME = "my_package"\nUSE_FEATURE_X = "ON"\n')),(0,i.kt)("h4",{id:"buildapt-repos"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.apt-repos]")),(0,i.kt)("p",null,"Optional. This category allows you to add extra APT repositories to the image. This is useful if you need to install some packages that are not available in the default repositories, which is common for third-party packages."),(0,i.kt)("p",null,"Multiple syntaxes are supported:"),(0,i.kt)("h5",{id:"using-a-deb-file"},"Using a ",(0,i.kt)("inlineCode",{parentName:"h5"},"deb")," file"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},"[build.apt-repos]\ncuda = { deb-uri = 'https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/{{ if eq .Arch \"amd64\" }}x86_64{{else}}sbsa{{end}}/cuda-keyring_1.0-1_all.deb' }\n")),(0,i.kt)("p",null,"Note that ",(0,i.kt)("inlineCode",{parentName:"p"},'{{ if eq .Arch "amd64" }}x86_64{{else}}sbsa{{end}}')," is a template that will be replaced by ",(0,i.kt)("inlineCode",{parentName:"p"},"x86_64")," if the architecture is ",(0,i.kt)("inlineCode",{parentName:"p"},"amd64")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"sbsa")," otherwise. See ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/text/template"},"here")," for more information on the templating syntax."),(0,i.kt)("h5",{id:"using-a-repository-with-an-optional-keyring"},"Using a repository (with an optional keyring)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.apt-repos.librealsense]\ntype = "deb" # optional, defaults to "deb", can also be "deb-src"\nuri = "https://librealsense.intel.com/Debian/apt-repo"\ndistribution = "jammy" # optional, will default to the current distribution\ncomponents = ["main"]\nkeyring = "https://librealsense.intel.com/Debian/librealsense.pgp" # optional\n')),(0,i.kt)("p",null,"Note that in this case we use a subcategory to specify the property of this repository, but it can also be expressed using the ",(0,i.kt)("inlineCode",{parentName:"p"},"{}")," syntax like the previous example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.apt-repos]\nlibrealsense = { type = "deb", uri = "https://librealsense.intel.com/Debian/apt-repo", distribution = "jammy", components = ["main"], keyring = "https://librealsense.intel.com/Debian/librealsense.pgp" }\n')),(0,i.kt)("h4",{id:"builddependencies"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.dependencies]")),(0,i.kt)("p",null,"Optional. ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.dependencies]")," is used to specify the AICA libraries and ROS 2 packages that will be installed in the\nimage."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Those libraries and packages will not be available at runtime, only while building. If you need them for building ",(0,i.kt)("em",{parentName:"p"},"and")," running, add them to the ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies]")," section below instead.\nLibraries that are only required at runtime, and not at build time, can be declared with ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.run-dependencies]")," instead.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Those libraries and packages are built for specific versions of ROS 2, so make sure that the version you are using is compatible with your ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.image]"),".")),(0,i.kt)("p",null,"Components usually require the ",(0,i.kt)("inlineCode",{parentName:"p"},"control-libraries")," library. You can find the available\nversions ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/aica-technology/control-libraries/pkgs/container/control-libraries"},"here"),". If you are\nbuilding a hardware interface, you might want to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"network-interfaces")," library; you can find the available\nversions ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/aica-technology/network-interfaces/pkgs/container/network-interfaces"},"here"),"."),(0,i.kt)("p",null,"Components usually require the ",(0,i.kt)("inlineCode",{parentName:"p"},"modulo")," package. You can find the available\nversions ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/aica-technology/modulo/pkgs/container/modulo"},"here"),"."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Libraries are built in a specific way to be compatible with the AICA packaging system. Custom libraries are not\navailable yet.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Starting with version ",(0,i.kt)("inlineCode",{parentName:"p"},"1.0.0")," of the ",(0,i.kt)("inlineCode",{parentName:"p"},"package-builder"),", all libraries and packages need to have special metadata associated in their image. This is done automatically when building with newer versions of ",(0,i.kt)("inlineCode",{parentName:"p"},"package-builder"),". This means you won't be able to use older versions of certain libraries and packages with newer versions of ",(0,i.kt)("inlineCode",{parentName:"p"},"package-builder"),".")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.dependencies]\n"@aica/foss/control-libraries" = "v7.5.0"\n"@aica/foss/network-interfaces" = "v3.0.0"\n"@aica/foss/modulo" = "v4.2.0"\n"@myorg/mypackage" = "docker-image://ghcr.io/myorg/mypackage:v1.0.0"\n')),(0,i.kt)("h5",{id:"adding-version-constraints"},"Adding version constraints"),(0,i.kt)("p",null,"Because ",(0,i.kt)("inlineCode",{parentName:"p"},"package-builder")," will use your dependencies in the metadata of the component, the version of the dependencies will be expected when the component is used. You can tweak ",(0,i.kt)("em",{parentName:"p"},"which")," exact version is expected by using version constraints."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.dependencies]\n"@aica/foss/control-libraries" = {version = "v7.5.0", constraints = ">= 7.5.0"}\n')),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"By default, the version constraint is derived from the given version. It will be ",(0,i.kt)("inlineCode",{parentName:"p"},"~> X.Y")," where ",(0,i.kt)("inlineCode",{parentName:"p"},"X")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Y")," are the major and minor versions of the given version. This means that any version with the same major version and a minor version greater than or equal to the given minor version will be accepted.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"You can find more information about version constraints and their syntax ",(0,i.kt)("a",{parentName:"p",href:"#version-constraints"},"here"),".")),(0,i.kt)("h5",{id:"adding-build-time-dependencies"},"Adding build-time dependencies"),(0,i.kt)("p",null,"Sometimes you might want to add a library but not require it in the metadata of your component. We call those dependencies build-only dependencies. This might be useful when using a static library that is built into your component and thus is not needed at runtime."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.dependencies]\n"@myorg/mylib" = {version = "v7.5.0", build-only = true}\n')),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"You can also add version constraints to build-only dependencies.")),(0,i.kt)("h4",{id:"buildrun-dependencies"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.run-dependencies]")),(0,i.kt)("p",null,"Optional. This field is similar to ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.dependencies]")," but its content is not downloaded and added to the image during the build. Instead, the information contained there is used in the metadata of your component. When someone uses your component, they will be notified that they need to use a specific version of the added dependencies matching the one specified in this section."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.run-dependencies]\n"@myorg/mypackage" = ">= 1.0.0"\n')),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"The value expected for each entry is not a version but a version constraint. You can find more information about this concept and its syntax in the corresponding section ",(0,i.kt)("a",{parentName:"p",href:"#version-constraints"},"here"),".")),(0,i.kt)("h4",{id:"buildpackages"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.packages]")),(0,i.kt)("p",null,"Required. This category describes the different components that will be built."),(0,i.kt)("p",null,"The name of the component doesn't need to match the one set in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.xml"),"; it is only used during the build.\n",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.source]")," is required and defines the path to the component source code relative to the Docker\ncontext (usually the root of the repository)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.packages.my_component]\nsource = "my_component"\n')),(0,i.kt)("p",null,"You can add as many components as you want, e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.packages.another]\nsource = "another"\n\n[build.packages.evenmore]\nsource = "different-folder/event-more"\n')),(0,i.kt)("h5",{id:"buildpackagesxyzdependenciesapt"},(0,i.kt)("inlineCode",{parentName:"h5"},"[build.packages.XYZ.dependencies.apt]")),(0,i.kt)("p",null,"Optional. This category allows you to specify the APT packages that will be installed in the image. This is useful if\nyou need to install some system dependencies."),(0,i.kt)("p",null,"By default, available packages are based on the Ubuntu version used by the specified version of ROS2. You can find the list of\npackages ",(0,i.kt)("a",{parentName:"p",href:"https://packages.ubuntu.com/"},"here")," and the Ubuntu version used by the ROS2\ndistribution ",(0,i.kt)("a",{parentName:"p",href:"https://docs.ros.org/en/iron/Installation/Ubuntu-Install-Debians.html"},"here"),". See ",(0,i.kt)("a",{parentName:"p",href:"#buildapt-repos"},"this section")," to learn how to add extra APT repositories."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"You can either provide a version to be installed or ",(0,i.kt)("inlineCode",{parentName:"p"},"*")," to install the latest available version.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Packages specified in ",(0,i.kt)("inlineCode",{parentName:"p"},"<*depend>")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.xml")," will be installed through ",(0,i.kt)("inlineCode",{parentName:"p"},"rosdep")," automatically.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.packages.my_component.dependencies.apt]\nlibopencv-dev = "*"\nlibyaml-cpp-dev = "2.55.1"\n')),(0,i.kt)("h5",{id:"buildpackagesxyzdependenciespip"},(0,i.kt)("inlineCode",{parentName:"h5"},"[build.packages.XYZ.dependencies.pip]")),(0,i.kt)("p",null,"Optional. This category allows you to specify the Python packages that will be installed in the image."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"By default, ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," will check if your ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.source]")," folder contains a ",(0,i.kt)("inlineCode",{parentName:"p"},"requirements.txt"),"\nfile and install the packages specified inside."),(0,i.kt)("p",{parentName:"admonition"},"You can override the name of the file by using the ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies.pip.file]")," key.")),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies.pip.file]")," key and the ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies.pip.packages]")," list are\nmutually exclusive; you can only use one of them.")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies.pip.packages]")," roughly follows the format\nof ",(0,i.kt)("inlineCode",{parentName:"p"},"pip"),": ",(0,i.kt)("a",{parentName:"p",href:"https://pip.pypa.io/en/stable/reference/requirements-file-format/"},"https://pip.pypa.io/en/stable/reference/requirements-file-format/"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.packages.my_component.dependencies.pip]\n# e.g. if your requirements file is called `aica-requirements.txt`\nfile = "aica-requirements.txt"\n\n# OR\n[build.packages.my_component.dependencies.pip.packages]\nnumpy = "2.0.0" # equivalent to `numpy==2.0.0`\nopencv-python = "\\*" # equivalent to `opencv-python`\nscipy = ">=1.0.0" # equivalent to `scipy>=1.0.0`\n')),(0,i.kt)("h4",{id:"buildstages"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.stages]")),(0,i.kt)("p",null,"Optional. This category allows you to define custom stages that can be used with ",(0,i.kt)("inlineCode",{parentName:"p"},"docker build --target"),". These are\nuseful if you want to run some extra commands during or at the end of the build process or if you need a custom output."),(0,i.kt)("p",null,"Here is an example that will call some Python code during the build process. The name of the stage, ",(0,i.kt)("inlineCode",{parentName:"p"},"list"),", will be used\nwith ",(0,i.kt)("inlineCode",{parentName:"p"},"docker build --target list")," to run this stage."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"[build.stages.XYZ.from]")," is required; it is the stage of the build process on top of which this stage will run. It can\nbe any of:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"base"),": only the environment has been applied"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"code"),": based on ",(0,i.kt)("inlineCode",{parentName:"li"},"base"),", the code has been copied)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"development"),": based on ",(0,i.kt)("inlineCode",{parentName:"li"},"code"),", runnable image setup for debugging with dependencies installed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"build"),": based on ",(0,i.kt)("inlineCode",{parentName:"li"},"code"),", the component has been built and the dependencies installed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"test"),": based on ",(0,i.kt)("inlineCode",{parentName:"li"},"build"),", the component has been tested"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"production"),": scratch image containing just to built component")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"[build.stages.XYZ.run]")," is required. It is the command that will be run in the stage. The command will be run as a\nnon-root user with the ",(0,i.kt)("inlineCode",{parentName:"p"},"colcon")," workspace setup and the current working directory will be the ",(0,i.kt)("inlineCode",{parentName:"p"},"colcon")," workspace. The\nfollowing environment variables should be available:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"WORKSPACE"),": the path to the ",(0,i.kt)("inlineCode",{parentName:"li"},"colcon")," workspace, which is also the current working directory"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"USER"),": the name of the non-root user"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"HOME"),": the path to the home directory of the non-root user"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ROS_DISTRO"),": the ROS2 distribution used to build the component"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ROS2_WORKSPACE"),": the path to the workspace where the standard ROS2 packages are installed as well as\nthe ",(0,i.kt)("inlineCode",{parentName:"li"},"[build.dependencies]")," packages"),(0,i.kt)("li",{parentName:"ul"},"any other environment variables set by ",(0,i.kt)("inlineCode",{parentName:"li"},"colcon"),"'s ",(0,i.kt)("inlineCode",{parentName:"li"},"${WORKSPACE}/install/setup.bash"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.stages.list]\nfrom = "development"\nrun = """\npython3 ${WORKSPACE}/src/my_component/script.py\n"""\n')),(0,i.kt)("h3",{id:"metadata"},(0,i.kt)("inlineCode",{parentName:"h3"},"[metadata]")),(0,i.kt)("p",null,"Required."),(0,i.kt)("h4",{id:"metadataversion"},(0,i.kt)("inlineCode",{parentName:"h4"},"[metadata.version]")),(0,i.kt)("p",null,"Required. Must be a ",(0,i.kt)("a",{parentName:"p",href:"https://semver.org/"},"semver-compliant")," version string."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[metadata]\nversion = "1.0.0"\n')),(0,i.kt)("h4",{id:"metadatadescription"},(0,i.kt)("inlineCode",{parentName:"h4"},"[metadata.description]")),(0,i.kt)("p",null,"Optional. A short description of the component."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[metadata]\ndescription = "My awesome component"\n')),(0,i.kt)("h4",{id:"metadatacollection"},(0,i.kt)("inlineCode",{parentName:"h4"},"[metadata.collection]")),(0,i.kt)("p",null,"Required when using multiple ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages]"),", otherwise ignored. This must contain the names of the collection being built (the set of multiple components)."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"[metadata.collection.name]")," is required. It is the name of the collection."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"[metadata.collection.ros-name]")," is optional. This must be specified if ",(0,i.kt)("inlineCode",{parentName:"p"},"[metadata.collection.name]")," is not a valid ROS package name."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[metadata.collection]\nname = "my-collection"\nros-name = "my_collection" # required because `my-collection` is not a valid ROS package name\n')),(0,i.kt)("h4",{id:"advanced-usage"},"Advanced usage"),(0,i.kt)("h5",{id:"docker-image"},(0,i.kt)("inlineCode",{parentName:"h5"},"docker-image://")),(0,i.kt)("p",null,"As documented above, you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-image://")," to specify your own ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.dependencies]")," packages. However,\nyou can also use it anywhere you are giving the tag to a Docker image. This is useful if you want to use a custom base\nimage for example."),(0,i.kt)("p",null,"Some examples:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build]\nimage = "docker-image://ghcr.io/myorg/myimage:v1.0.0"\n\n# and/or\n\n[build.dependencies]\n"@aica/foss/control-libraries" = "docker-image://ghcr.io/myorg/myimage:v1.0.0"\n')),(0,i.kt)("h5",{id:"build-context"},(0,i.kt)("inlineCode",{parentName:"h5"},"build-context://")),(0,i.kt)("p",null,"Similarly to ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-image://"),", you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"build-context://")," to specify a context given to ",(0,i.kt)("inlineCode",{parentName:"p"},"docker build"),"\nwith ",(0,i.kt)("inlineCode",{parentName:"p"},"--build-context")," (see ",(0,i.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/commandline/buildx_build/#build-context"},"here"),").\nThis can also be used in ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.source]")," to build a component from a folder outside your root context or\nfrom another Docker image."),(0,i.kt)("p",null,"Some examples:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.dependencies]\n"@aica/foss/control-libraries" = "build-context://cl"\n\n# and/or\n\n[build.packages.component]\nsource = "build-context://my_source"\n')),(0,i.kt)("h5",{id:"version-constraints"},"Version constraints"),(0,i.kt)("p",null,"Version constraints follow the syntax of the ",(0,i.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/language/expressions/version-constraints.html"},"Terraform version constraints")," which is similar to syntax used by NPM, yarn or pip. Here is a quick summary:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Versions constraints are composed of one or more conditions separated by commas, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},">= 1.0.0, < 2.0.0"),"."),(0,i.kt)("li",{parentName:"ul"},"Each version specified must be a valid ",(0,i.kt)("a",{parentName:"li",href:"https://semver.org/"},"semver")," version, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"1.0.0"),"."),(0,i.kt)("li",{parentName:"ul"},"The following operators are supported:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"=")," or no operator: allow only the exact version, cannot be combined with other conditions."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"!="),": exclude a specific version."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},">"),", ",(0,i.kt)("inlineCode",{parentName:"li"},">="),", ",(0,i.kt)("inlineCode",{parentName:"li"},"<"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"<="),": comparison against a specific version, allowing any version matching the operator. ",(0,i.kt)("inlineCode",{parentName:"li"},">")," allows newer version and ",(0,i.kt)("inlineCode",{parentName:"li"},"<")," allows older version."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"~>"),": allows only the right most number of the version to increase. This is useful to allow only patch or minor versions to increase, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"~> 1.0")," allows ",(0,i.kt)("inlineCode",{parentName:"li"},"1.1"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"1.2"),", etc. but not ",(0,i.kt)("inlineCode",{parentName:"li"},"2.0")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"~> 1.0.0")," allows ",(0,i.kt)("inlineCode",{parentName:"li"},"1.0.1"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"1.0.2"),", etc. but not ",(0,i.kt)("inlineCode",{parentName:"li"},"1.1.0"),".")))),(0,i.kt)("h3",{id:"examples"},"Examples"),(0,i.kt)("h4",{id:"basic-setup"},"Basic setup"),(0,i.kt)("p",null,"Run with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -f aica-package.toml -t my_component .\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'#syntax=ghcr.io/aica-technology/package-builder:v1\n\n[build]\ntype = "ros"\nimage = "v1.0.0-iron"\n\n[build.dependencies]\n"@aica/foss/control-libraries" = "v7.3.0"\n"@aica/foss/modulo" = "v4.0.0"\n\n[build.packages.component]\nsource = "./custom_component_package"\n')),(0,i.kt)("h4",{id:"with-dependencies"},"With dependencies"),(0,i.kt)("p",null,"Run with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -f aica-package.toml -t my_component .\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'#syntax=ghcr.io/aica-technology/package-builder:v1\n\n[build]\ntype = "ros"\nimage = "v1.0.0-iron"\n\n[build.dependencies]\n"@aica/foss/control-libraries" = "v7.3.0"\n"@aica/foss/modulo" = "v4.0.0"\n\n[build.packages.component]\nsource = "./custom_component_package"\n\n# `requirements.txt` will be used by default\n\n[build.packages.component.dependencies.apt]\nlibopencv-dev = "*"\n')),(0,i.kt)("h4",{id:"advanced-usage-1"},"Advanced usage"),(0,i.kt)("p",null,"Run with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -f aica-package.toml \\\n  --build-context my_source=../my_folder \\\n  --build-context base=ghcr.io/myorg/myimage:v1.0.0 \\\n  --build-context cl=ghcr.io/myorg/myimage:v2.0.0 \\\n  -t my_component \\\n  .\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'#syntax=ghcr.io/aica-technology/package-builder:v1\n\n[build]\ntype = "ros"\nimage = "docker-image://base"\n\n[build.dependencies]\n"@aica/foss/control-libraries" = "build-context://cl"\n"@aica/foss/modulo" = "v4.0.0"\n\n[build.packages.component]\nsource = "build-context://my_source"\n')),(0,i.kt)("h4",{id:"custom-stage"},"Custom stage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -f aica-package.toml -t my_component --target list .\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'#syntax=ghcr.io/aica-technology/package-builder:v1\n\n[build]\ntype = "ros"\nimage = "v1.0.0-iron"\n\n[build.packages.component]\n\n[build.stages.list]\nfrom = "development"\nrun = """\npython3 ${WORKSPACE}/src/my_component/script.py\n"""\n')),(0,i.kt)("h2",{id:"docker-build-usage"},(0,i.kt)("inlineCode",{parentName:"h2"},"docker build")," usage"),(0,i.kt)("p",null,"We use a custom Docker syntax, which allows us to define the configuration through ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," instead of\na ",(0,i.kt)("inlineCode",{parentName:"p"},"Dockerfile"),". However, we are still using ",(0,i.kt)("inlineCode",{parentName:"p"},"docker")," directly to build. This means we have access to all the\noptions ",(0,i.kt)("inlineCode",{parentName:"p"},"docker build")," provides but also that you don't need to install or learn anything new to build your component."),(0,i.kt)("p",null,"Some useful options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-t")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"--tag"),": tag the image with a name and an optional tag, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"-t my_component")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"-t my_component:latest")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--platform"),": build for a specific platform, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--platform linux/amd64")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"--platform linux/arm64")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--build-arg"),": this can be used to override any key in ",(0,i.kt)("inlineCode",{parentName:"li"},"aica-package.toml"),",\ne.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--build-arg config.build.image=jazzy")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--ssh"),": this can be used to pass SSH credentials to Docker, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--ssh default"),". You will also need to\nset ",(0,i.kt)("inlineCode",{parentName:"li"},"[build.ssh]")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"true")," in ",(0,i.kt)("inlineCode",{parentName:"li"},"aica-package.toml")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--build-context"),": this can be used to pass a context to Docker, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--build-context my_source=../my_folder"),". You\ncan then use ",(0,i.kt)("inlineCode",{parentName:"li"},"build-context://my_source")," in ",(0,i.kt)("inlineCode",{parentName:"li"},"aica-package.toml")," to build a component from a folder outside your root\ncontext or from another Docker image"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--target"),": this can be used to run a custom stage, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--target list"),". You can then use ",(0,i.kt)("inlineCode",{parentName:"li"},"[build.stages.list]"),"\nin ",(0,i.kt)("inlineCode",{parentName:"li"},"aica-package.toml")," to define the stage"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--no-cache"),": this can be used to force Docker to rebuild the image from scratch"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--progress"),": this can be used to change the progress output, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--progress plain")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"--progress auto")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--label"),": this can be used to add metadata to the image, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--label my_label=my_value"))))}m.isMDXComponent=!0}}]);