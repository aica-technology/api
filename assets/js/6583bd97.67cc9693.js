"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[602],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>g});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},p=Object.keys(e);for(a=0;a<p.length;a++)n=p[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(a=0;a<p.length;a++)n=p[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=a.createContext({}),l=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=l(e.components);return a.createElement(i.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,p=e.originalType,i=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=l(n),d=o,g=c["".concat(i,".").concat(d)]||c[d]||u[d]||p;return n?a.createElement(g,r(r({ref:t},m),{},{components:n})):a.createElement(g,r({ref:t},m))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var p=n.length,r=new Array(p);r[0]=d;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[c]="string"==typeof e?e:o,r[1]=s;for(var l=2;l<p;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),o=n(6010);const p={tabItem:"tabItem_Ymn6"};function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(p.tabItem,r),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>C});var a=n(7462),o=n(7294),p=n(6010),r=n(2466),s=n(6550),i=n(1980),l=n(7392),m=n(12);function c(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:o}}=e;return{value:t,label:n,attributes:a,default:o}}))}function u(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??c(n);return function(e){const t=(0,l.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function d(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:n}=e;const a=(0,s.k6)(),p=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,i._X)(p),(0,o.useCallback)((e=>{if(!p)return;const t=new URLSearchParams(a.location.search);t.set(p,e),a.replace({...a.location,search:t.toString()})}),[p,a])]}function _(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,p=u(e),[r,s]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:p}))),[i,l]=g({queryString:n,groupId:a}),[c,_]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,p]=(0,m.Nk)(n);return[a,(0,o.useCallback)((e=>{n&&p.set(e)}),[n,p])]}({groupId:a}),h=(()=>{const e=i??c;return d({value:e,tabValues:p})?e:null})();(0,o.useLayoutEffect)((()=>{h&&s(h)}),[h]);return{selectedValue:r,selectValue:(0,o.useCallback)((e=>{if(!d({value:e,tabValues:p}))throw new Error(`Can't select invalid tab value=${e}`);s(e),l(e),_(e)}),[l,_,p]),tabValues:p}}var h=n(2389);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function k(e){let{className:t,block:n,selectedValue:s,selectValue:i,tabValues:l}=e;const m=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.o5)(),u=e=>{const t=e.currentTarget,n=m.indexOf(t),a=l[n].value;a!==s&&(c(t),i(a))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=m.indexOf(e.currentTarget)+1;t=m[n]??m[0];break}case"ArrowLeft":{const n=m.indexOf(e.currentTarget)-1;t=m[n]??m[m.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,p.Z)("tabs",{"tabs--block":n},t)},l.map((e=>{let{value:t,label:n,attributes:r}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>m.push(e),onKeyDown:d,onClick:u},r,{className:(0,p.Z)("tabs__item",b.tabItem,r?.className,{"tabs__item--active":s===t})}),n??t)})))}function f(e){let{lazy:t,children:n,selectedValue:a}=e;const p=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=p.find((e=>e.props.value===a));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},p.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function y(e){const t=_(e);return o.createElement("div",{className:(0,p.Z)("tabs-container",b.tabList)},o.createElement(k,(0,a.Z)({},e,t)),o.createElement(f,(0,a.Z)({},e,t)))}function C(e){const t=(0,h.Z)();return o.createElement(y,(0,a.Z)({key:String(t)},e))}},9067:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>i,default:()=>g,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var a=n(7462),o=(n(7294),n(3905)),p=n(4866),r=n(5162);const s={sidebar_position:2,title:"Writing a component"},i="Writing a component",l={unversionedId:"reference/custom-components/custom-component",id:"reference/custom-components/custom-component",title:"Writing a component",description:"The following sections show example code snippets to illustrate how custom component classes can be implemented in",source:"@site/docs/reference/custom-components/02-custom-component.md",sourceDirName:"reference/custom-components",slug:"/reference/custom-components/custom-component",permalink:"/docs/reference/custom-components/custom-component",draft:!1,editUrl:"https://github.com/aica-technology/api/tree/main/docs/docs/reference/custom-components/02-custom-component.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Writing a component"},sidebar:"programmingReferenceSidebar",previous:{title:"Creating a component package",permalink:"/docs/reference/custom-components/component-package"},next:{title:"Describing a component",permalink:"/docs/reference/custom-components/component-descriptions"}},m={},c=[{value:"Inheritance and registration",id:"inheritance-and-registration",level:2},{value:"Adding parameters",id:"adding-parameters",level:2},{value:"Accessing parameter values",id:"accessing-parameter-values",level:3},{value:"Default value",id:"default-value",level:3},{value:"Validating parameters",id:"validating-parameters",level:2},{value:"Adding signals",id:"adding-signals",level:2},{value:"Signal name",id:"signal-name",level:3},{value:"Message types",id:"message-types",level:3},{value:"Inputs",id:"inputs",level:3},{value:"User callbacks",id:"user-callbacks",level:4},{value:"Outputs",id:"outputs",level:3},{value:"Adding periodic behavior",id:"adding-periodic-behavior",level:2}],u={toc:c},d="wrapper";function g(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"writing-a-component"},"Writing a component"),(0,o.kt)("p",null,"The following sections show example code snippets to illustrate how custom component classes can be implemented in\nPython or C++."),(0,o.kt)("h2",{id:"inheritance-and-registration"},"Inheritance and registration"),(0,o.kt)("p",null,"Custom component classes should derive from either the ",(0,o.kt)("inlineCode",{parentName:"p"},"Component")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"LifecycleComponent")," class of the\n",(0,o.kt)("inlineCode",{parentName:"p"},"modulo_components")," library. The following examples will use the ",(0,o.kt)("inlineCode",{parentName:"p"},"Component")," class, but the usage for\n",(0,o.kt)("inlineCode",{parentName:"p"},"LifecycleComponent")," is equivalent."),(0,o.kt)("p",null,"Refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://aica-technology.github.io/modulo/versions/main"},"modulo documentation")," for a comprehensive API\nreference on components."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"LifecycleComponent")," class extends the common component interface with additional functions that can be overridden\nfor customized behavior. These functions are ",(0,o.kt)("inlineCode",{parentName:"p"},"on_step_callback()")," and the collection of state transition callbacks."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Lifecycle state transition callbacks"),(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("code",null,"on_configure_callback()")),(0,o.kt)("li",null,(0,o.kt)("code",null,"on_activate_callback()")),(0,o.kt)("li",null,(0,o.kt)("code",null,"on_deactivate_callback()")),(0,o.kt)("li",null,(0,o.kt)("code",null,"on_cleanup_callback()")),(0,o.kt)("li",null,(0,o.kt)("code",null,"on_shutdown_callback()")),(0,o.kt)("li",null,(0,o.kt)("code",null,"on_error_callback()"))))),(0,o.kt)("p",null,"Registration is the term for defining and exporting a unique class name for the component so that it can be dynamically\nloaded by the AICA state engine."),(0,o.kt)(p.Z,{groupId:"programming-language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="py_component.py"',title:'"py_component.py"'},"from modulo_components.component import Component\n\nclass PyComponent(Component):\n    def __init__(self, node_name: str, *args, **kwargs):\n        super().__init__(node_name, *args, **kwargs)\n        # use the constructor to declare parameters, predicates, services, signals and periodic callback functions\n")),(0,o.kt)("p",null,"To register the component, define an entry point under ",(0,o.kt)("inlineCode",{parentName:"p"},"python_components")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"setup.cfg")," that refers to the class\nimplementation."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="setup.cfg"',title:'"setup.cfg"'},"[options.entry_points]\npython_components =\n    custom_component_package::PyComponent = custom_component_package.py_component:PyComponent\n"))),(0,o.kt)(r.Z,{value:"c++",label:"C++",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="include/custom_component_package/CppComponent.hpp"',title:'"include/custom_component_package/CppComponent.hpp"'},"#pragma once\n\n#include <modulo_components/Component.hpp>\n\nnamespace custom_component_package {\nclass CppComponent : public modulo_components::Component {\npublic:\n  explicit CppComponent(const rclcpp::NodeOptions& options);\n};\n}  // namespace custom_component_package\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="src/CppComponent.cpp"',title:'"src/CppComponent.cpp"'},'#include "custom_component_package/CppComponent.hpp"\n\nnamespace custom_component_package {\nCppComponent::CppComponent(const rclcpp::NodeOptions& options) : modulo_components::Component(options) {\n  // use the constructor to declare parameters, predicates, services, signals and periodic callback functions\n}\n\n} // namespace custom_component_package\n\n#include "rclcpp_components/register_node_macro.hpp"\n\nRCLCPP_COMPONENTS_REGISTER_NODE(custom_component_package::CppComponent)\n')),(0,o.kt)("p",null,"To register the component, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"RCLCPP_COMPONENTS_REGISTER_NODE")," macro in the source file.\nThen add, register and export the component library in ",(0,o.kt)("inlineCode",{parentName:"p"},"CMakeLists.txt"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cmake",metastring:'title="CMakeLists.txt"',title:'"CMakeLists.txt"'},'ament_auto_add_library(custom_component SHARED ${PROJECT_SOURCE_DIR}/src/CppComponent.cpp)\nrclcpp_components_register_nodes(custom_component "custom_component_package::CppComponent")\n\ninstall(TARGETS custom_component\n        LIBRARY DESTINATION lib)\n')))),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"When registering a component, the class name must be defined in the namespace of the package, delimited by double\ncolons ",(0,o.kt)("inlineCode",{parentName:"p"},"::"),". For example, the component classes ",(0,o.kt)("inlineCode",{parentName:"p"},"CppComponent")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"PyComponent")," in the\npackage ",(0,o.kt)("inlineCode",{parentName:"p"},"custom_component_package")," should be registered as ",(0,o.kt)("inlineCode",{parentName:"p"},"custom_component_package::CppComponent"),"\nand ",(0,o.kt)("inlineCode",{parentName:"p"},"custom_component_package::PyComponent")," respectively, so that the package can be inferred from the registered name.")),(0,o.kt)("h2",{id:"adding-parameters"},"Adding parameters"),(0,o.kt)("p",null,"A component parameter can be added either as a class attribute or declared in-line."),(0,o.kt)("p",null,"Component implementations use parameter objects and types as defined in the ",(0,o.kt)("inlineCode",{parentName:"p"},"state_representation")," library.\nThese parameter objects are automatically mapped and bound to the corresponding ROS 2 parameter on the parameter\ninterface."),(0,o.kt)(p.Z,{groupId:"programming-language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},"import state_representation as sr\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},'    def __init__(self, node_name: str, *args, **kwargs):\n        # ...\n        \n        # define a parameter as a class attribute, then add it to the component using the attribute name\n        self._parameter_a = sr.Parameter("A", sr.ParameterType.INT)\n        self.add_parameter("_parameter_a", "Description of parameter A")\n        \n        # or, define and add a parameter in-line\n        self.add_parameter(sr.Parameter("B", sr.ParameterType.DOUBLE), "Description of parameter B")\n'))),(0,o.kt)(r.Z,{value:"c++",label:"C++",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="include/custom_component_package/CppComponent.hpp"',title:'"include/custom_component_package/CppComponent.hpp"'},"class CppComponent : public modulo_components::Component {\npublic:\n  explicit CppComponent(const rclcpp::NodeOptions& options);\n\nprotected:\n  std::shared_ptr<state_representation::Parameter<int>> parameter_a_;\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="src/CppComponent.cpp"',title:'"src/CppComponent.cpp"'},'CppComponent::CppComponent(const rclcpp::NodeOptions& options):\n    modulo_components::Component(options),\n    parameter_a_(std::make_shared<state_representation::Parameter<int>>("A")) {\n  // ...\n  \n  // define a parameter as a class property, then add it to the component\n  this->add_parameter(this->parameter_a_, "Description of parameter A");\n  \n  // or, define and add a parameter in-line\n  this->add_parameter(std::make_shared<state_representation::Parameter<double>>("B"), "Description of parameter B");\n}\n')))),(0,o.kt)("h3",{id:"accessing-parameter-values"},"Accessing parameter values"),(0,o.kt)("p",null,"To access the parameter value in other parts of the component implementation, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"get_value()")," method either on\nthe class attribute or on the parameter object returned by ",(0,o.kt)("inlineCode",{parentName:"p"},"get_parameter()")),(0,o.kt)(p.Z,{groupId:"programming-language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'self._parameter_a.get_value()\n\nself.get_parameter("B").get_value()\n'))),(0,o.kt)(r.Z,{value:"c++",label:"C++",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},'this->parameter_a_->get_value();\n\nthis->get_parameter("B")->get_value();\n')))),(0,o.kt)("h3",{id:"default-value"},"Default value"),(0,o.kt)("p",null,"If no default value is declared, the parameter object will be empty until set."),(0,o.kt)(p.Z,{groupId:"programming-language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'x = sr.Parameter("X", sr.ParameterType.INT)  # no default value!\nx.is_empty()  # evaluates to True\nx.get_value()  # raises an EmptyStateError\n\ny = sr.Parameter("Y", 10, sr.ParameterType.INT)  # default value: 10\ny.is_empty()  # evaluates to False\ny.get_value()  # evaluates to 10\n'))),(0,o.kt)(r.Z,{value:"c++",label:"C++",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},'auto x = std::make_shared<state_representation::Parameter<int>>("X");  // no default value!\nx->is_empty();  // evaluates to true\nx->get_value();  // raises an EmptyStateException\n\nauto y = std::make_shared<state_representation::Parameter<int>>("Y", 10);  // default value: 10\ny->is_empty();  // evaluates to false\ny->get_value();  // evaluates to 10\n')))),(0,o.kt)("h2",{id:"validating-parameters"},"Validating parameters"),(0,o.kt)("p",null,"Whenever a component parameter is changed, the special ",(0,o.kt)("inlineCode",{parentName:"p"},"on_validate_parameter_callback()")," function is triggered.\nOverride this function to perform parameter validation logic."),(0,o.kt)("p",null,"If the function returns false, the incoming parameter change is rejected and the internal component parameter is not\nchanged. If the function returns true, the incoming parameter change is accepted and applied to the component parameter."),(0,o.kt)("p",null,"The validation function can freely mutate the incoming parameter value before returning true, for example to constrain\na numerical value between some upper and lower bounds."),(0,o.kt)(p.Z,{groupId:"programming-language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},'    def on_validate_parameter_callback(self, parameter: sr.Parameter) -> bool:\n        if parameter.get_name() == "A":\n            if parameter.is_empty():\n                self.get_logger().warn("Parameter A cannot be empty")\n                return False\n        elif parameter.get_name() == "B":\n            if parameter and parameter.get_value() < 0.0:\n                self.get_logger().warn(f"Parameter B cannot be negative ({parameter.get_value()}). "\n                                        "Setting value to 0.0 instead")\n                parameter.set_value(0.0)\n        return True\n'))),(0,o.kt)(r.Z,{value:"c++",label:"C++",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="include/custom_component_package/CppComponent.hpp"',title:'"include/custom_component_package/CppComponent.hpp"'},"class CppComponent : public modulo_components::Component {\n// ...\n\nprotected:\n  bool\n  on_validate_parameter_callback(const std::shared_ptr<state_representation::ParameterInterface>& parameter) override;\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="src/CppComponent.cpp"',title:'"src/CppComponent.cpp"'},'bool CppComponent::on_validate_parameter_callback(\n    const std::shared_ptr<ParameterInterface>& parameter\n) {\n  if (parameter->get_name() == "A") {\n    if (parameter->is_empty()) {\n      RCLCPP_WARN(this->get_logger(), "Parameter A cannot be empty");\n      return false;\n    }\n  } else if (parameter->get_name() == "B") {\n    if (parameter && parameter->get_value() < 0.0) {\n      RCLCPP_WARN(this->get_logger(), "Parameter B cannot be negative (%f). Setting value to 0.0 instead",\n                  parameter->get_value());\n      parameter->set_value(0.0);\n    }\n  }\n  return true;\n}\n')))),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Use the logging interface provided by ",(0,o.kt)("inlineCode",{parentName:"p"},"modulo_components")," wherever appropriate. This will forward log messages from\ncustom components to ROS logs and the user interface.")),(0,o.kt)("h2",{id:"adding-signals"},"Adding signals"),(0,o.kt)("p",null,"Components make it possible to bind data objects to publishers or subscribers with class attributes. For inputs, this\nmeans that the associated input data object is automatically updated every time a new message is received. For outputs,\nthis means that internal changes to the output data object will automatically be updated in the publisher."),(0,o.kt)("p",null,"The binding logic is supported for a number of common message data types. To interface with non-standard messages\n(for example, to communicate with ROS 2 nodes using custom message types outside the AICA framework), it is possible to\ndefine raw publishers and subscribers following standard ROS 2 conventions."),(0,o.kt)("h3",{id:"signal-name"},"Signal name"),(0,o.kt)("p",null,"Component signals are declared and managed with unique signal names. The signal name is used to determine the default\ntopic. For a signal added under the name ",(0,o.kt)("inlineCode",{parentName:"p"},"foo"),", the default topic will be ",(0,o.kt)("inlineCode",{parentName:"p"},"~/foo"),". Adding a signal also automatically\ncreates and associates a parameter with that signal with the parameter name ",(0,o.kt)("inlineCode",{parentName:"p"},"[signal_name]_topic"),", which is used to\noverride the default topic name at runtime. For a signal name ",(0,o.kt)("inlineCode",{parentName:"p"},"foo"),", the parameter associated to the signal topic will\nbe called ",(0,o.kt)("inlineCode",{parentName:"p"},"foo_topic"),"."),(0,o.kt)("p",null,"For these reasons, signal names must adhere to the following rules:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Signal names must be unique for all inputs and outputs of the component"),(0,o.kt)("li",{parentName:"ul"},"Signal names must be written in ",(0,o.kt)("inlineCode",{parentName:"li"},"lower_snake_case")," (using only lowercase letters, numbers and underscores)"),(0,o.kt)("li",{parentName:"ul"},"Signal names cannot start with a number or underscore.")),(0,o.kt)("h3",{id:"message-types"},"Message types"),(0,o.kt)("p",null,"The supported message types are defined in the ",(0,o.kt)("inlineCode",{parentName:"p"},"std_msgs")," library and include:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Boolean"),(0,o.kt)("li",{parentName:"ul"},"integer"),(0,o.kt)("li",{parentName:"ul"},"floating point numbers (doubles)"),(0,o.kt)("li",{parentName:"ul"},"floating point array"),(0,o.kt)("li",{parentName:"ul"},"string")),(0,o.kt)("p",null,"For robotic applications, AICA components make it particularly easy to receive, manipulate and send joint and Cartesian\nstates using the ",(0,o.kt)("inlineCode",{parentName:"p"},"state_representation")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"clproto")," message encoding libraries."),(0,o.kt)("p",null,"State objects can be bound to inputs or outputs and are sent in a special ",(0,o.kt)("inlineCode",{parentName:"p"},"EncodedState")," message type."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"In C++, the message type is automatically inferred from the data type when binding inputs or outputs."),(0,o.kt)("p",{parentName:"admonition"},"Because Python is dynamically typed, the message type of the class attribute must be specified when binding inputs or\noutputs. The specific message types are available from the following imports."),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-python"},"from std_msgs.msg import Bool, Int32, Float64, Float64MultiArray, String\n\nfrom modulo_core.encoded_state import EncodedState\n"))),(0,o.kt)("h3",{id:"inputs"},"Inputs"),(0,o.kt)("p",null,"To add an input, bind a class attribute of a supported type to a subscriber using the ",(0,o.kt)("inlineCode",{parentName:"p"},"add_input")," function."),(0,o.kt)("p",null,"The following example adds two inputs: one as an integer and one as joint positions."),(0,o.kt)(p.Z,{groupId:"programming-language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},"from std_msgs.msg import Int32\n\nfrom modulo_core.encoded_state import EncodedState\nfrom state_representation import JointPositions\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},'    def __init__(self, node_name: str, *args, **kwargs):\n        # ...\n        \n        # define input data objects as a class attribute\n        self._input_number = 0\n        self._input_positions = JointPositions()\n        \n        # bind the attribute to an output using the attribute name and message type\n        self.add_input("number", "_input_number", Int32)\n        self.add_input("positions", "_input_positions", EncodedState)\n'))),(0,o.kt)(r.Z,{value:"c++",label:"C++",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="include/custom_component_package/CppComponent.hpp"',title:'"include/custom_component_package/CppComponent.hpp"'},"class CppComponent : public modulo_components::Component {\npublic:\n  explicit CppComponent(const rclcpp::NodeOptions& options);\n\nprivate:\n  std::shared_ptr<int> input_number_;\n  std::shared_ptr<state_representation::JointPositions> input_positions_;\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="src/CppComponent.cpp"',title:'"src/CppComponent.cpp"'},'CppComponent::CppComponent(const rclcpp::NodeOptions& options):\n    modulo_components::Component(options),\n    input_number_(std::make_shared<int>(0)),\n    input_positions_(std::make_shared<state_representation::CartesianPose>()) {\n  // ...\n  \n  // the message type is inferred from the data type\n  this->add_input("number", this->input_number_);\n  this->add_input("pose", this->input_positions_);\n}\n')))),(0,o.kt)("p",null,"The value of the class attribute will automatically be updated whenever a new message is received."),(0,o.kt)("h4",{id:"user-callbacks"},"User callbacks"),(0,o.kt)("p",null,"Sometimes it is useful to react to an incoming message by triggering custom callback behavior. For example,\na component might want to keep track of the number of input messages it received."),(0,o.kt)(p.Z,{groupId:"programming-language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},'    def __init__(self, node_name: str, *args, **kwargs):\n        # ...\n        \n        self._input_number = 0\n        self._number_of_samples = 0\n\n        # bind a custom callback function to be triggered by the input\n        self.add_input("number", "_input_number", Int32, user_callback=self._number_callback)\n    \n    def _number_callback():\n        self._number_of_samples += 1\n'))),(0,o.kt)(r.Z,{value:"c++",label:"C++",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="include/custom_component_package/CppComponent.hpp"',title:'"include/custom_component_package/CppComponent.hpp"'},"class CppComponent : public modulo_components::Component {\npublic:\n  explicit CppComponent(const rclcpp::NodeOptions& options);\n\nprivate:\n  void number_callback();\n\n  std::shared_ptr<int> input_number_;\n  int number_of_samples_;\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="src/CppComponent.cpp"',title:'"src/CppComponent.cpp"'},'CppComponent::CppComponent(const rclcpp::NodeOptions& options):\n    modulo_components::Component(options),\n    input_number_(std::make_shared<int>(0)),\n    number_of_samples_(0) {\n  // ...\n  \n  // bind a custom callback function to be triggered by the input\n  this->add_input("number", this->input_number_, [this]() {\n      this->number_callback();\n  });\n}\n\nvoid CppComponent::number_callback() {\n  this->number_of_samples_++;\n}\n')))),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The bound class attribute is updated ",(0,o.kt)("em",{parentName:"p"},"before")," the user callback is triggered. Accessing the class attribute within the\nuser callback function will always yield the latest value.")),(0,o.kt)("h3",{id:"outputs"},"Outputs"),(0,o.kt)("p",null,"To add an output, bind a class attribute of a supported type to a publisher using the ",(0,o.kt)("inlineCode",{parentName:"p"},"add_output")," function."),(0,o.kt)("p",null,"The following example adds two outputs: one as a floating point number and one as a Cartesian pose."),(0,o.kt)(p.Z,{groupId:"programming-language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"When using the ",(0,o.kt)("inlineCode",{parentName:"p"},"EncodedState")," type for an output, the specific underlying state type must also be defined using the\n",(0,o.kt)("inlineCode",{parentName:"p"},"MessageType")," enumeration in the ",(0,o.kt)("inlineCode",{parentName:"p"},"clproto")," library.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},"from std_msgs.msg import Float64\n\nfrom modulo_core.encoded_state import EncodedState\n\nfrom clproto import MessageType\nfrom state_representation import CartesianPose\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},'    def __init__(self, node_name: str, *args, **kwargs):\n        # ...\n        \n        # define output data objects as a class attribute\n        self._output_number = 3.14\n        self._output_pose = CartesianPose()\n        \n        # bind the attribute to an output using the attribute name and message type\n        self.add_output("number", "_output_number", Float64)\n        \n        # for encoded states, further define the expected state type when binding the output\n        self.add_output("pose", "_output_pose", EncodedState, MessageType.CARTESIAN_POSE_MESSAGE)\n'))),(0,o.kt)(r.Z,{value:"c++",label:"C++",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="include/custom_component_package/CppComponent.hpp"',title:'"include/custom_component_package/CppComponent.hpp"'},"class CppComponent : public modulo_components::Component {\npublic:\n  explicit CppComponent(const rclcpp::NodeOptions& options);\n\nprivate:\n  std::shared_ptr<double> output_number_;\n  std::shared_ptr<state_representation::CartesianPose> output_pose_;\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="src/CppComponent.cpp"',title:'"src/CppComponent.cpp"'},'CppComponent::CppComponent(const rclcpp::NodeOptions& options):\n    modulo_components::Component(options),\n    output_number_(std::make_shared<double>(3.14),\n    output_pose_(std::make_shared<state_representation::CartesianPose>()) {\n  // ...\n  \n  // the message type is inferred from the data type\n  this->add_output("number", this->output_number_);\n  this->add_output("pose", this->output_pose_);\n}\n')))),(0,o.kt)("p",null,"The value of the class attribute can then be freely changed in other parts of the component implementation to update the\npublished value. For example, it may be changed in a periodic step function, or as a result of parameter validation, a\nservice call, an input subscription callback or a lifecycle transition."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Empty states will not be published."),(0,o.kt)("p",{parentName:"admonition"},"Lifecycle components publish outputs only when the component is in the ",(0,o.kt)("inlineCode",{parentName:"p"},"ACTIVE")," lifecycle state.")),(0,o.kt)("h2",{id:"adding-periodic-behavior"},"Adding periodic behavior"),(0,o.kt)("p",null,"Every component has a built-in ",(0,o.kt)("inlineCode",{parentName:"p"},"rate"),' parameter that defines the execution rate of periodic behaviors in Hertz. For\nexample, a component with a rate of 10 Hertz will execute periodic behaviors ten times per second. The evaluation\nof periodic behaviors is referred to as the component "step".'),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Lifecycle components evaluate periodic callback functions only when the component is in the ",(0,o.kt)("inlineCode",{parentName:"p"},"ACTIVE")," lifecycle state.")),(0,o.kt)("p",null,"Custom periodic behavior can be implemented by overriding the ",(0,o.kt)("inlineCode",{parentName:"p"},"on_step_callback")," function. For example, a random number\ngenerator component might run a pseudo-random function every step so that the published output is always updated."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Custom periodic callback functions are always evaluated ",(0,o.kt)("em",{parentName:"p"},"before")," outputs are published. If a periodic callback function\nmakes any changes to the value of a data object that is bound to and output, the latest value will be published in the\nsame component step.")),(0,o.kt)(p.Z,{groupId:"programming-language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},"from random import random\n\nfrom std_msgs.msg import Float64\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="custom_component.py"',title:'"custom_component.py"'},'    def __init__(self, node_name: str, *args, **kwargs):\n        # ...\n        \n        self._random_number = random()\n        self.add_output("random_number", "_random_number", Float64)\n    \n    def on_step_callback():\n        self._random_number = random()\n'))),(0,o.kt)(r.Z,{value:"c++",label:"C++",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="include/custom_component_package/CppComponent.hpp"',title:'"include/custom_component_package/CppComponent.hpp"'},"class CppComponent : public modulo_components::Component {\npublic:\n  explicit CppComponent(const rclcpp::NodeOptions& options);\n\nprivate:\n  void on_step_callback() override;\n\n  std::shared_ptr<double> random_number_;\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp",metastring:'title="src/CppComponent.cpp"',title:'"src/CppComponent.cpp"'},'// ...\n\n#include <random>\n\nstatic double generate_random_number() {\n    return static_cast<double>(rand()) / RAND_MAX;\n}\n\nCppComponent::CppComponent(const rclcpp::NodeOptions& options):\n    modulo_components::Component(options),\n    random_number_(std::make_shared<double>(this->generate_random_number())) {\n  // ...\n  \n  this->add_output("random_number", this->random_number_);\n}\n\nvoid CppComponent::on_step_callback() {\n  *this->random_number_ = this->generate_random_number();\n}\n')))))}g.isMDXComponent=!0}}]);