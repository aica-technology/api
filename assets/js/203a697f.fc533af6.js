"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[737],{3905:(e,a,t)=>{t.d(a,{Zo:()=>s,kt:()=>k});var n=t(7294);function i(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){i(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function r(e,a){if(null==e)return{};var t,n,i=function(e,a){if(null==e)return{};var t,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(i[t]=e[t]);return i}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=n.createContext({}),p=function(e){var a=n.useContext(c),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},s=function(e){var a=p(e.components);return n.createElement(c.Provider,{value:a},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,s=r(e,["components","mdxType","originalType","parentName"]),d=p(t),u=i,k=d["".concat(c,".").concat(u)]||d[u]||m[u]||o;return t?n.createElement(k,l(l({ref:a},s),{},{components:t})):n.createElement(k,l({ref:a},s))}));function k(e,a){var t=arguments,i=a&&a.mdxType;if("string"==typeof e||i){var o=t.length,l=new Array(o);l[0]=u;var r={};for(var c in a)hasOwnProperty.call(a,c)&&(r[c]=a[c]);r.originalType=e,r[d]="string"==typeof e?e:i,l[1]=r;for(var p=2;p<o;p++)l[p]=t[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},5489:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var n=t(7462),i=(t(7294),t(3905));const o={sidebar_position:5,title:"Package builder configuration reference"},l="aica-package.toml configuration reference",r={unversionedId:"reference/custom-components/aica-package-toml",id:"reference/custom-components/aica-package-toml",title:"Package builder configuration reference",description:"The aica-package.toml file is used to configure the build process for a component package.",source:"@site/docs/reference/custom-components/05-aica-package-toml.md",sourceDirName:"reference/custom-components",slug:"/reference/custom-components/aica-package-toml",permalink:"/docs/reference/custom-components/aica-package-toml",draft:!1,editUrl:"https://github.com/aica-technology/api/tree/main/docs/docs/reference/custom-components/05-aica-package-toml.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"Package builder configuration reference"},sidebar:"programmingReferenceSidebar",previous:{title:"Building a component package",permalink:"/docs/reference/custom-components/package-building"}},c={},p=[{value:"<code>TOML</code> syntax",id:"toml-syntax",level:2},{value:"<code>aica-package.toml</code> file structure",id:"aica-packagetoml-file-structure",level:2},{value:"<code>#syntax</code>",id:"syntax",level:3},{value:"<code>[build]</code>",id:"build",level:3},{value:"<code>[build.cmake_args]</code>",id:"buildcmake_args",level:4},{value:"<code>[build.environment]</code>",id:"buildenvironment",level:4},{value:"<code>[build.environment.aica.libraries]</code>",id:"buildenvironmentaicalibraries",level:5},{value:"<code>[build.environment.aica.ros]</code>",id:"buildenvironmentaicaros",level:5},{value:"<code>[build.packages]</code>",id:"buildpackages",level:4},{value:"<code>[build.packages.XYZ.dependencies.apt]</code>",id:"buildpackagesxyzdependenciesapt",level:5},{value:"<code>[build.packages.XYZ.dependencies.pip]</code>",id:"buildpackagesxyzdependenciespip",level:5},{value:"<code>[build.stages]</code>",id:"buildstages",level:4},{value:"Advanced usage",id:"advanced-usage",level:4},{value:"<code>docker-image://</code>",id:"docker-image",level:5},{value:"<code>build-context://</code>",id:"build-context",level:5},{value:"Examples",id:"examples",level:3},{value:"Basic setup",id:"basic-setup",level:4},{value:"With dependencies",id:"with-dependencies",level:4},{value:"Advanced usage",id:"advanced-usage-1",level:4},{value:"Custom stage",id:"custom-stage",level:4},{value:"<code>docker build</code> usage",id:"docker-build-usage",level:2}],s={toc:p},d="wrapper";function m(e){let{components:a,...t}=e;return(0,i.kt)(d,(0,n.Z)({},s,t,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"aica-packagetoml-configuration-reference"},(0,i.kt)("inlineCode",{parentName:"h1"},"aica-package.toml")," configuration reference"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," file is used to configure the build process for a component package."),(0,i.kt)("h2",{id:"toml-syntax"},(0,i.kt)("inlineCode",{parentName:"h2"},"TOML")," syntax"),(0,i.kt)("p",null,"The configuration uses the simple ",(0,i.kt)("a",{parentName:"p",href:"https://toml.io/en/"},"TOML")," file format which is easy to read and write. Here are a\nfew examples:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml"},'# add a category\n[category]\n# then you can add keys and values\nkey-string = "value string"\nkey-bool = true\nkey-int = 42\nkey-float = 3.14\n\n# you can nest categories\n[category.sub-category]\nkey = "value"\n')),(0,i.kt)("p",null,"Note that each ",(0,i.kt)("inlineCode",{parentName:"p"},"string")," value needs to be quoted, but keys and values of other types do not."),(0,i.kt)("h2",{id:"aica-packagetoml-file-structure"},(0,i.kt)("inlineCode",{parentName:"h2"},"aica-package.toml")," file structure"),(0,i.kt)("p",null,"This example contains every possible key and value that can be used in an ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," file and explains each of\nthem."),(0,i.kt)("h3",{id:"syntax"},(0,i.kt)("inlineCode",{parentName:"h3"},"#syntax")),(0,i.kt)("p",null,"Each ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," should start with ",(0,i.kt)("inlineCode",{parentName:"p"},"#syntax=ghcr.io/aica-technology/package-builder"),". This is used to specify\nthe Docker syntax and version used to build the package."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},"#syntax=ghcr.io/aica-technology/package-builder:v0.0.9\n")),(0,i.kt)("p",null,"You can find the available\nversions ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/orgs/aica-technology/packages/container/package/package-builder"},"here"),"."),(0,i.kt)("h3",{id:"build"},(0,i.kt)("inlineCode",{parentName:"h3"},"[build]")),(0,i.kt)("p",null,"Required. The only ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.type]")," currently supported is ",(0,i.kt)("inlineCode",{parentName:"p"},"ros"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build]\ntype = "ros"\n')),(0,i.kt)("h4",{id:"buildcmake_args"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.cmake_args]")),(0,i.kt)("p",null,"Optional. In this category, you can specify arguments which will be passed to CMake through ",(0,i.kt)("inlineCode",{parentName:"p"},"-DK1=V1 -DK2=V2 ...")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.cmake_args]\n# here are a few examples\nPACKAGE_NAME = "my_package"\nUSE_FEATURE_X = "ON"\n')),(0,i.kt)("h4",{id:"buildenvironment"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.environment]")),(0,i.kt)("p",null,"Required. This category describes the environment (ROS version, libraries, etc.) that will be used to build the\ncomponents."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"[build.environment.ssh]")," is optional (defaults to ",(0,i.kt)("inlineCode",{parentName:"p"},"false"),"). If set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),", any call to ",(0,i.kt)("inlineCode",{parentName:"p"},"CMake"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"pip")," or custom\nstage will have access to the SSH credentials given to Docker with ",(0,i.kt)("inlineCode",{parentName:"p"},"--ssh default"),". This is useful if you need to clone\na private repository in CMakeLists.txt or install a private Python package from git."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},"[build.environment]\nssh = false\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"[build.environment.aica]")," is required. ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.environment.aica.image]")," is the tag of the\nAICA ",(0,i.kt)("inlineCode",{parentName:"p"},"ghcr.io/aica-technology/ros2-control")," image that will be used to build the components. Those images are tagged\nafter the ROS2 distributions and are\navailable ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/aica-technology/docker-images/pkgs/container/ros2-control"},"here"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.environment.aica]\nimage = "iron"\n')),(0,i.kt)("h5",{id:"buildenvironmentaicalibraries"},(0,i.kt)("inlineCode",{parentName:"h5"},"[build.environment.aica.libraries]")),(0,i.kt)("p",null,"Optional. ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.environment.aica.libraries]")," is used to specify the AICA libraries that will be installed in the\nimage."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Those libraries will not be available at runtime, only while building. If you need them for building ",(0,i.kt)("em",{parentName:"p"},"and")," running, add\nthem to the ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies]")," section below instead.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Those libraries are built for specific versions of ROS2, so make sure that the version you are using is compatible with\nyour ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.environment.aica.image]"),".")),(0,i.kt)("p",null,"Components usually require the ",(0,i.kt)("inlineCode",{parentName:"p"},"control-libraries")," library. You can find the available\nversions ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/aica-technology/control-libraries/pkgs/container/control-libraries"},"here"),". If you are\nbuilding a hardware interface, you might want to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"network-interfaces")," library; you can find the available\nversions ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/aica-technology/network-interfaces/pkgs/container/network-interfaces"},"here"),"."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Those libraries are built in a specific way to be compatible with the AICA packaging system. Custom libraries are not\navailable yet.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.environment.aica.libraries]\n"@aica/foss/control-libraries" = "v7.2.0"\n"@aica/foss/network-interfaces" = "v2.0.1"\n')),(0,i.kt)("h5",{id:"buildenvironmentaicaros"},(0,i.kt)("inlineCode",{parentName:"h5"},"[build.environment.aica.ros]")),(0,i.kt)("p",null,"Optional. ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.environment.aica.ros]")," is used to specify the ROS2 packages that will be installed in the image."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Those packages will not be available at runtime, only while building.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Those packages are built for specific versions of ROS2, so make sure that the version you are using is compatible with\nyour ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.environment.aica.image]"),".")),(0,i.kt)("p",null,"Components usually require the ",(0,i.kt)("inlineCode",{parentName:"p"},"modulo")," package. You can find the available\nversions ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/aica-technology/modulo/pkgs/container/modulo"},"here"),"."),(0,i.kt)("p",null,"You can also use any other ROS2 package that has been built with ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml"),". For example, if you had a\ncomponent built with a tag of ",(0,i.kt)("inlineCode",{parentName:"p"},"ghcr.io/myorg/mypackage:v1.0.0"),", you could use it like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.environment.aica.ros]\n"@aica/foss/modulo" = "v3.2.0"\n"@myorg/mypackage" = "docker-image://ghcr.io/myorg/mypackage:v1.0.0"\n')),(0,i.kt)("h4",{id:"buildpackages"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.packages]")),(0,i.kt)("p",null,"Required. This category describes the different components that will be built."),(0,i.kt)("p",null,"The name of the component doesn't need to match the one set in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.xml"),"; it is only used during the build.\n",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.source]")," is required and defines the path to the component source code relative to the Docker\ncontext (usually the root of the repository)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.packages.my_component]\nsource = "my_component"\n')),(0,i.kt)("p",null,"You can add as many components as you want, e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.packages.another]\nsource = "another"\n\n[build.packages.evenmore]\nsource = "different-folder/event-more"\n')),(0,i.kt)("h5",{id:"buildpackagesxyzdependenciesapt"},(0,i.kt)("inlineCode",{parentName:"h5"},"[build.packages.XYZ.dependencies.apt]")),(0,i.kt)("p",null,"Optional. This category allows you to specify the APT packages that will be installed in the image. This is useful if\nyou need to install some system dependencies."),(0,i.kt)("p",null,"Available packages are based on the Ubuntu version used by the specified version of ROS2. You can find the list of\npackages ",(0,i.kt)("a",{parentName:"p",href:"https://packages.ubuntu.com/"},"here")," and the Ubuntu version used by the ROS2\ndistribution ",(0,i.kt)("a",{parentName:"p",href:"https://docs.ros.org/en/iron/Installation/Ubuntu-Install-Debians.html"},"here"),"."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"*")," is the only supported version for now. It will install the latest version of the package.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Packages specified in ",(0,i.kt)("inlineCode",{parentName:"p"},"<*depend>")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.xml")," will be installed through ",(0,i.kt)("inlineCode",{parentName:"p"},"rosdep")," automatically.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.packages.my_component.dependencies.apt]\nlibopencv-dev = "*"\nlibyaml-cpp-dev = "*"\n')),(0,i.kt)("h5",{id:"buildpackagesxyzdependenciespip"},(0,i.kt)("inlineCode",{parentName:"h5"},"[build.packages.XYZ.dependencies.pip]")),(0,i.kt)("p",null,"Optional. This category allows you to specify the Python packages that will be installed in the image."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"By default, ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," will check if your ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.source]")," folder contains a ",(0,i.kt)("inlineCode",{parentName:"p"},"requirements.txt"),"\nfile and install the packages specified inside."),(0,i.kt)("p",{parentName:"admonition"},"You can override the name of the file by using the ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies.pip.file]")," key.")),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies.pip.file]")," key and the ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies.pip.packages]")," list are\nmutually exclusive; you can only use one of them.")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.dependencies.pip.packages]")," roughly follows the format\nof ",(0,i.kt)("inlineCode",{parentName:"p"},"pip"),": ",(0,i.kt)("a",{parentName:"p",href:"https://pip.pypa.io/en/stable/reference/requirements-file-format/"},"https://pip.pypa.io/en/stable/reference/requirements-file-format/"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.packages.my_component.dependencies.pip]\n# e.g. if your requirements file is called `aica-requirements.txt`\nfile = "aica-requirements.txt"\n\n# OR\n[build.packages.my_component.dependencies.pip.packages]\nnumpy = "2.0.0" # equivalent to `numpy==2.0.0`\nopencv-python = "\\*" # equivalent to `opencv-python`\nscipy = ">=1.0.0" # equivalent to `scipy>=1.0.0`\n')),(0,i.kt)("h4",{id:"buildstages"},(0,i.kt)("inlineCode",{parentName:"h4"},"[build.stages]")),(0,i.kt)("p",null,"Optional. This category allows you to define custom stages that can be used with ",(0,i.kt)("inlineCode",{parentName:"p"},"docker build --target"),". These are\nuseful if you want to run some extra commands during or at the end of the build process or if you need a custom output."),(0,i.kt)("p",null,"Here is an example that will call some Python code during the build process. The name of the stage, ",(0,i.kt)("inlineCode",{parentName:"p"},"list"),", will be used\nwith ",(0,i.kt)("inlineCode",{parentName:"p"},"docker build --target list")," to run this stage."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"[build.stages.XYZ.from]")," is required; it is the stage of the build process on top of which this stage will run. It can\nbe any of:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"base"),": only the environment has been applied"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"code"),": based on ",(0,i.kt)("inlineCode",{parentName:"li"},"base"),", the code has been copied)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"development"),": based on ",(0,i.kt)("inlineCode",{parentName:"li"},"code"),", runnable image setup for debugging with dependencies installed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"build"),": based on ",(0,i.kt)("inlineCode",{parentName:"li"},"code"),", the component has been built and the dependencies installed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"test"),": based on ",(0,i.kt)("inlineCode",{parentName:"li"},"build"),", the component has been tested"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"production"),": scratch image containing just to built component")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"[build.stages.XYZ.run]")," is required. It is the command that will be run in the stage. The command will be run as a\nnon-root user with the ",(0,i.kt)("inlineCode",{parentName:"p"},"colcon")," workspace setup and the current working directory will be the ",(0,i.kt)("inlineCode",{parentName:"p"},"colcon")," workspace. The\nfollowing environment variables should be available:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"WORKSPACE"),": the path to the ",(0,i.kt)("inlineCode",{parentName:"li"},"colcon")," workspace, which is also the current working directory"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"USER"),": the name of the non-root user"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"HOME"),": the path to the home directory of the non-root user"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ROS_DISTRO"),": the ROS2 distribution used to build the component"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ROS2_WORKSPACE"),": the path to the workspace where the standard ROS2 packages are installed as well as\nthe ",(0,i.kt)("inlineCode",{parentName:"li"},"[build.environment.aica.ros]")," packages"),(0,i.kt)("li",{parentName:"ul"},"any other environment variables set by ",(0,i.kt)("inlineCode",{parentName:"li"},"colcon"),"'s ",(0,i.kt)("inlineCode",{parentName:"li"},"${WORKSPACE}/install/setup.bash"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.stages.list]\nfrom = "development"\nrun = """\npython3 ${WORKSPACE}/src/my_component/script.py\n"""\n')),(0,i.kt)("h4",{id:"advanced-usage"},"Advanced usage"),(0,i.kt)("h5",{id:"docker-image"},(0,i.kt)("inlineCode",{parentName:"h5"},"docker-image://")),(0,i.kt)("p",null,"As documented above, you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-image://")," to specify your own ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.environment.aica.ros]")," packages. However,\nyou can also use it anywhere you are giving the tag to a Docker image. This is useful if you want to use a custom base\nimage for example."),(0,i.kt)("p",null,"Some examples:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.environment.aica]\nimage = "docker-image://ghcr.io/myorg/myimage:v1.0.0"\n\n# and/or\n\n[build.environment.aica.libraries]\n"@aica/foss/control-libraries" = "docker-image://ghcr.io/myorg/myimage:v1.0.0"\n')),(0,i.kt)("h5",{id:"build-context"},(0,i.kt)("inlineCode",{parentName:"h5"},"build-context://")),(0,i.kt)("p",null,"Similarly to ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-image://"),", you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"build-context://")," to specify a context given to ",(0,i.kt)("inlineCode",{parentName:"p"},"docker build"),"\nwith ",(0,i.kt)("inlineCode",{parentName:"p"},"--build-context")," (see ",(0,i.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/commandline/buildx_build/#build-context"},"here"),").\nThis can also be used in ",(0,i.kt)("inlineCode",{parentName:"p"},"[build.packages.XYZ.source]")," to build a component from a folder outside your root context or\nfrom another Docker image."),(0,i.kt)("p",null,"Some examples:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'[build.environment.aica.libraries]\n"@aica/foss/control-libraries" = "build-context://cl"\n\n# and/or\n\n[build.packages.component]\nsource = "build-context://my_source"\n')),(0,i.kt)("h3",{id:"examples"},"Examples"),(0,i.kt)("h4",{id:"basic-setup"},"Basic setup"),(0,i.kt)("p",null,"Run with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -f aica-package.toml -t my_component .\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'#syntax=ghcr.io/aica-technology/package-builder:v0.0.9\n\n[build]\ntype = "ros"\n\n[build.environment.aica]\nimage = "iron"\n\n[build.environment.aica.libraries]\n"@aica/foss/control-libraries" = "v7.2.0"\n\n[build.environment.aica.ros]\n"@aica/foss/modulo" = "v3.2.0"\n\n[build.packages.component]\nsource = "./custom_component_package"\n')),(0,i.kt)("h4",{id:"with-dependencies"},"With dependencies"),(0,i.kt)("p",null,"Run with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -f aica-package.toml -t my_component .\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'#syntax=ghcr.io/aica-technology/package-builder:v0.0.9\n\n[build]\ntype = "ros"\n\n[build.environment.aica]\nimage = "iron"\n\n[build.environment.aica.libraries]\n"@aica/foss/control-libraries" = "v7.2.0"\n\n[build.environment.aica.ros]\n"@aica/foss/modulo" = "v3.2.0"\n\n[build.packages.component]\nsource = "./custom_component_package"\n\n# `requirements.txt` will be used by default\n\n[build.packages.component.dependencies.apt]\nlibopencv-dev = "*"\n')),(0,i.kt)("h4",{id:"advanced-usage-1"},"Advanced usage"),(0,i.kt)("p",null,"Run with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -f aica-package.toml \\\n  --build-context my_source=../my_folder \\\n  --build-context base=ghcr.io/myorg/myimage:v1.0.0 \\\n  --build-context cl=ghcr.io/myorg/myimage:v2.0.0 \\\n  -t my_component \\\n  .\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'#syntax=ghcr.io/aica-technology/package-builder:v0.0.9\n\n[build]\ntype = "ros"\n\n[build.environment.aica]\nimage = "docker-image://base"\n\n[build.environment.aica.libraries]\n"@aica/foss/control-libraries" = "build-context://cl"\n\n[build.environment.aica.ros]\n"@aica/foss/modulo" = "v3.2.0"\n\n[build.packages.component]\nsource = "build-context://my_source"\n')),(0,i.kt)("h4",{id:"custom-stage"},"Custom stage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -f aica-package.toml -t my_component --target list .\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="aica-package.toml"',title:'"aica-package.toml"'},'#syntax=ghcr.io/aica-technology/package-builder:v0.0.9\n\n[build]\ntype = "ros"\n\n[build.environment.aica]\nimage = "iron"\n\n[build.packages.component]\n\n[build.stages.list]\nfrom = "development"\nrun = """\npython3 ${WORKSPACE}/src/my_component/script.py\n"""\n')),(0,i.kt)("h2",{id:"docker-build-usage"},(0,i.kt)("inlineCode",{parentName:"h2"},"docker build")," usage"),(0,i.kt)("p",null,"We use a custom Docker syntax, which allows us to define the configuration through ",(0,i.kt)("inlineCode",{parentName:"p"},"aica-package.toml")," instead of\na ",(0,i.kt)("inlineCode",{parentName:"p"},"Dockerfile"),". However, we are still using ",(0,i.kt)("inlineCode",{parentName:"p"},"docker")," directly to build. This means we have access to all the\noptions ",(0,i.kt)("inlineCode",{parentName:"p"},"docker build")," provides but also that you don't need to install or learn anything new to build your component."),(0,i.kt)("p",null,"Some useful options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-t")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"--tag"),": tag the image with a name and an optional tag, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"-t my_component")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"-t my_component:latest")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--platform"),": build for a specific platform, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--platform linux/amd64")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"--platform linux/arm64")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--build-arg"),": this can be used to override any key in ",(0,i.kt)("inlineCode",{parentName:"li"},"aica-package.toml"),",\ne.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--build-arg config.build.environment.aica.image=jazzy")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--ssh"),": this can be used to pass SSH credentials to Docker, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--ssh default"),". You will also need to\nset ",(0,i.kt)("inlineCode",{parentName:"li"},"[build.environment.ssh]")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"true")," in ",(0,i.kt)("inlineCode",{parentName:"li"},"aica-package.toml")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--build-context"),": this can be used to pass a context to Docker, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--build-context my_source=../my_folder"),". You\ncan then use ",(0,i.kt)("inlineCode",{parentName:"li"},"build-context://my_source")," in ",(0,i.kt)("inlineCode",{parentName:"li"},"aica-package.toml")," to build a component from a folder outside your root\ncontext or from another Docker image"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--target"),": this can be used to run a custom stage, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--target list"),". You can then use ",(0,i.kt)("inlineCode",{parentName:"li"},"[build.stages.list]"),"\nin ",(0,i.kt)("inlineCode",{parentName:"li"},"aica-package.toml")," to define the stage"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--no-cache"),": this can be used to force Docker to rebuild the image from scratch"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--progress"),": this can be used to change the progress output, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"--progress plain")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"--progress auto"))))}m.isMDXComponent=!0}}]);